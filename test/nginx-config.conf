# Nginx configuration for beyondmebtw.com/test
# Add this to your nginx server block for beyondmebtw.com

location /test/ {
    # Set root to where your files are located
    # Adjust this path to match your actual server setup
    alias /var/www/beyondmebtw.com/test/;

    # Enable directory indexing for development (remove in production)
    autoindex on;

    # Add CORS headers for all files
    add_header 'Access-Control-Allow-Origin' '*' always;
    add_header 'Access-Control-Allow-Methods' 'GET, OPTIONS' always;
    add_header 'Access-Control-Allow-Headers' 'Origin, X-Requested-With, Content-Type, Accept' always;

    # Handle preflight requests
    if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, OPTIONS';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
    }

    # Proper MIME types for different file extensions
    types {
        application/octet-stream onnx;
        application/wasm wasm;
        text/html html htm;
        text/css css;
        application/javascript js;
        image/png png;
        image/jpeg jpg jpeg;
    }

    # Security headers for WASM and SharedArrayBuffer support
    add_header 'Cross-Origin-Embedder-Policy' 'require-corp' always;
    add_header 'Cross-Origin-Opener-Policy' 'same-origin' always;

    # Cache control for model files (they're large and don't change often)
    location ~* \.(onnx)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        add_header 'Access-Control-Allow-Origin' '*' always;
    }
}

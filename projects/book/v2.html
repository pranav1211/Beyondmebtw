<html>

<head>
    <script src="https://cdn.jsdelivr.net/npm/quagga/dist/quagga.min.js"></script>
    <style>
        #vid {
            display: none;
        }

        #scanButton {
            width: 200px;
            height: 50px;
            margin-top: 10px;
        }

        #barcodeResult {
            margin-top: 10px;
            font-weight: bold;
        }
    </style>
</head>

<body>

    <div>
        <video id="vid" autoplay></video>
        <button id="scanButton">Scan Barcode</button>
        <div id="barcodeResult"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let scanButton = document.querySelector('#scanButton');
            let video = document.querySelector('#vid');
            let barcodeResult = document.querySelector('#barcodeResult');

            // Configure QuaggaJS
            Quagga.init({
                inputStream: {
                    name: "Live",
                    type: "LiveStream",
                    target: video
                },
                decoder: {
                    readers: ["ean_reader", "ean_8_reader", "upc_reader", "upc_e_reader"] // List of barcode formats to scan
                }
            }, function (err) {
                if (err) {
                    console.error("Quagga initialization failed: ", err);
                    return;
                }
                console.log("Quagga initialization succeeded");

                // Start QuaggaJS when the "Scan Barcode" button is clicked
                scanButton.addEventListener('click', function () {
                    Quagga.start();
                });

                // Detect barcode
                Quagga.onDetected(function (result) {
                    console.log("Barcode detected and decoded: ", result.codeResult.code);
                    barcodeResult.textContent = "Barcode detected and decoded: " + result.codeResult.code;

                    // Stop QuaggaJS after a barcode is detected
                    Quagga.stop();
                });
            });

            // Stop QuaggaJS and release camera when leaving the page
            window.addEventListener('beforeunload', function () {
                Quagga.stop();
            });
        });
    </script>
</body>

</html>
